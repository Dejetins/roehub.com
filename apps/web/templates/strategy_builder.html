{% extends "base.html" %}

{% block content %}
  <section
    class="panel"
    data-strategy-page="builder"
    data-api-create-path="/api/strategies"
    data-api-markets-path="/api/market-data/markets"
    data-api-instruments-path="/api/market-data/instruments"
    data-api-indicators-path="/api/indicators"
    data-details-path-prefix="/strategies/"
    data-prefill-query-param="prefill"
    data-prefill-storage="sessionStorage"
  >
    <div class="panel-heading">
      <h1>Create strategy</h1>
      <a class="button-link button-link--secondary" href="/strategies">Back to list</a>
    </div>
    <p>Build StrategySpec v1 visually. No JSON textarea is exposed in this UI.</p>

    <div id="strategy-error-banner" class="error-banner hidden" role="alert"></div>
    <div id="strategy-validation-errors" class="validation-list hidden"></div>

    <form id="strategy-builder-form" class="stack-form">
      <fieldset class="panel panel--soft">
        <legend>Instrument</legend>

        <label for="builder-market-id">Market</label>
        <select id="builder-market-id" required>
          <option value="">Select market</option>
        </select>

        <label for="builder-symbol-query">Symbol search</label>
        <input
          id="builder-symbol-query"
          type="text"
          placeholder="Type symbol, for example BTCUSDT"
          autocomplete="off"
        >
        <p id="builder-selected-symbol" class="muted-text">Selected symbol: none</p>
        <input id="builder-symbol-value" type="hidden">
        <ul id="builder-symbol-suggestions" class="suggestions-list"></ul>
      </fieldset>

      <fieldset class="panel panel--soft">
        <legend>Timeframe</legend>
        <label for="builder-timeframe">Timeframe</label>
        <select id="builder-timeframe" required>
          <option value="1m">1m</option>
          <option value="5m">5m</option>
          <option value="15m">15m</option>
          <option value="1h">1h</option>
          <option value="4h">4h</option>
          <option value="1d">1d</option>
        </select>
      </fieldset>

      <fieldset class="panel panel--soft">
        <legend>Indicators</legend>
        <p class="muted-text">
          Add one or more indicator blocks. Each block sends payload shape:
          <code>{ "id": "...", "inputs": {...}, "params": {...} }</code>.
        </p>
        <button id="builder-add-indicator" class="button-link" type="button">
          Add indicator
        </button>
        <div id="builder-indicator-blocks" class="indicator-blocks"></div>
      </fieldset>

      <div class="inline-actions">
        <button id="builder-submit" class="button-link" type="submit">Create strategy</button>
        <a class="button-link button-link--secondary" href="/strategies">Cancel</a>
      </div>
    </form>
  </section>
{% endblock %}

{% block scripts %}
  <script type="module" src="/assets/strategy_ui.js"></script>
{% endblock %}
